Version 4
SHEET 1 3812 1508
WIRE -608 -880 -640 -880
WIRE -288 -880 -608 -880
WIRE -96 -880 -288 -880
WIRE 112 -880 -96 -880
WIRE 368 -880 112 -880
WIRE 544 -880 368 -880
WIRE 752 -880 544 -880
WIRE 1152 -880 752 -880
WIRE 1632 -880 1152 -880
WIRE 1856 -880 1632 -880
WIRE 1872 -880 1856 -880
WIRE 112 -832 112 -880
WIRE 752 -832 752 -880
WIRE -608 -800 -608 -880
WIRE -96 -768 -96 -880
WIRE 544 -768 544 -880
WIRE 1152 -768 1152 -880
WIRE 112 -720 112 -752
WIRE 112 -720 -32 -720
WIRE 752 -720 752 -752
WIRE 752 -720 608 -720
WIRE 1088 -720 1056 -720
WIRE 1632 -720 1632 -880
WIRE -288 -704 -288 -880
WIRE 368 -704 368 -880
WIRE 112 -688 112 -720
WIRE 752 -688 752 -720
WIRE -608 -672 -608 -720
WIRE -96 -640 -96 -672
WIRE 48 -640 -96 -640
WIRE 544 -640 544 -672
WIRE 688 -640 544 -640
WIRE 1152 -640 1152 -672
WIRE 1280 -640 1152 -640
WIRE 1328 -640 1280 -640
WIRE 1456 -640 1408 -640
WIRE 1488 -640 1456 -640
WIRE 1584 -640 1568 -640
WIRE 1856 -624 1856 -880
WIRE -96 -592 -96 -640
WIRE 544 -592 544 -640
WIRE 1456 -544 1456 -640
WIRE 1680 -544 1456 -544
WIRE 1808 -544 1760 -544
WIRE -288 -496 -288 -640
WIRE -96 -496 -96 -512
WIRE -96 -496 -288 -496
WIRE 752 -496 752 -592
WIRE 944 -496 752 -496
WIRE 1056 -496 1056 -720
WIRE 1056 -496 944 -496
WIRE 1632 -480 1632 -624
WIRE 1856 -480 1856 -528
WIRE 1456 -464 1456 -544
WIRE -96 -448 -96 -496
WIRE 0 -432 -16 -432
WIRE 112 -432 112 -592
WIRE 112 -432 80 -432
WIRE 128 -432 112 -432
WIRE 224 -432 208 -432
WIRE 368 -432 368 -640
WIRE 544 -432 544 -512
WIRE 544 -432 368 -432
WIRE 944 -432 944 -496
WIRE 544 -416 544 -432
WIRE 944 -336 944 -368
WIRE 1456 -336 1456 -400
WIRE -96 -288 -96 -368
WIRE 544 -288 544 -336
WIRE -288 -272 -352 -272
WIRE -160 -272 -208 -272
WIRE -16 -224 -16 -432
WIRE 224 -224 224 -432
WIRE -704 -176 -768 -176
WIRE -592 -176 -624 -176
WIRE -560 -176 -592 -176
WIRE -464 -176 -480 -176
WIRE -448 -176 -464 -176
WIRE -352 -176 -352 -272
WIRE -352 -176 -368 -176
WIRE -240 -176 -352 -176
WIRE -160 -176 -160 -272
WIRE -160 -176 -176 -176
WIRE -112 -176 -160 -176
WIRE -80 -176 -112 -176
WIRE 320 -176 288 -176
WIRE 400 -176 320 -176
WIRE 496 -176 480 -176
WIRE 528 -176 496 -176
WIRE 576 -176 528 -176
WIRE 1456 -176 1456 -272
WIRE 1456 -176 656 -176
WIRE 1632 -176 1632 -400
WIRE 1632 -176 1456 -176
WIRE 1856 -176 1856 -400
WIRE 1856 -176 1632 -176
WIRE 2080 -176 1856 -176
WIRE 2240 -176 2080 -176
WIRE 2448 -176 2240 -176
WIRE 752 -128 752 -496
WIRE 752 -128 640 -128
WIRE 864 -128 752 -128
WIRE 2080 -128 2080 -176
WIRE 528 -112 528 -176
WIRE 640 -112 640 -128
WIRE -464 -96 -464 -176
WIRE -160 -96 -160 -176
WIRE -112 -96 -112 -176
WIRE 96 -96 -112 -96
WIRE 160 -96 144 -96
WIRE 320 -96 320 -176
WIRE 320 -96 160 -96
WIRE 2240 -96 2240 -176
WIRE -592 -80 -592 -176
WIRE 1152 -64 1152 -640
WIRE 1280 -64 1280 -640
WIRE 1456 -64 1456 -176
WIRE 752 -48 752 -128
WIRE 864 -32 864 -128
WIRE 2080 -16 2080 -64
WIRE 96 0 96 -96
WIRE 160 0 160 -96
WIRE 640 0 640 -32
WIRE 688 0 640 0
WIRE 1632 0 1632 -176
WIRE 1856 0 1856 -176
WIRE 464 16 352 16
WIRE 528 16 528 -32
WIRE 528 16 464 16
WIRE 352 32 352 16
WIRE -592 48 -592 -16
WIRE -464 48 -464 -16
WIRE -464 48 -592 48
WIRE -160 48 -160 -16
WIRE -160 48 -464 48
WIRE 464 48 464 16
WIRE 528 48 528 16
WIRE 640 48 640 0
WIRE 1456 80 1456 0
WIRE 2080 96 2080 64
WIRE 2240 96 2240 -16
WIRE -592 112 -592 48
WIRE 352 128 352 112
WIRE 464 128 464 112
WIRE 464 128 352 128
WIRE 528 128 528 112
WIRE 528 128 464 128
WIRE 528 144 528 128
WIRE 640 144 640 128
WIRE 752 144 752 48
WIRE 752 144 640 144
WIRE 864 144 864 32
WIRE 864 144 752 144
WIRE 1856 176 1856 80
WIRE 1456 192 1456 144
WIRE 1664 192 1456 192
WIRE 1808 192 1744 192
WIRE 592 240 480 240
WIRE 752 240 752 144
WIRE 752 240 656 240
WIRE -16 256 -16 -128
WIRE 336 256 -16 256
WIRE 224 304 224 -128
WIRE 224 304 112 304
WIRE 608 336 608 304
WIRE -16 352 -16 256
WIRE 224 352 224 304
WIRE 1632 368 1632 80
WIRE 336 384 336 256
WIRE 480 384 480 240
WIRE 480 384 336 384
WIRE 544 384 480 384
WIRE 752 384 752 240
WIRE 944 384 752 384
WIRE 1056 384 944 384
WIRE 1152 384 1152 16
WIRE 1280 384 1280 0
WIRE 1280 384 1152 384
WIRE 1312 384 1280 384
WIRE 1456 384 1456 192
WIRE 1456 384 1392 384
WIRE 1472 384 1456 384
WIRE 1584 384 1552 384
WIRE 112 400 112 304
WIRE 112 400 48 400
WIRE 160 400 112 400
WIRE 752 416 752 384
WIRE 944 432 944 384
WIRE 608 464 608 432
WIRE 688 464 608 464
WIRE 480 496 480 384
WIRE 1152 496 1152 384
WIRE 3088 496 3056 496
WIRE 3104 496 3088 496
WIRE 3280 496 3184 496
WIRE 3088 528 3088 496
WIRE -16 544 -16 448
WIRE 224 544 224 448
WIRE 752 544 752 512
WIRE 752 544 544 544
WIRE 1056 544 1056 384
WIRE 1088 544 1056 544
WIRE 752 560 752 544
WIRE 944 560 944 496
WIRE -608 576 -608 528
WIRE 2976 576 2976 496
WIRE 2976 576 2832 576
WIRE 608 608 608 464
WIRE 3088 624 3088 592
WIRE 2976 688 2976 576
WIRE 3088 688 3040 688
WIRE 3152 688 3088 688
WIRE 3280 688 3280 496
WIRE 3280 688 3216 688
WIRE -608 704 -608 656
WIRE -608 704 -640 704
WIRE -16 704 -16 624
WIRE -16 704 -608 704
WIRE 224 704 224 624
WIRE 224 704 -16 704
WIRE 480 704 480 592
WIRE 480 704 224 704
WIRE 608 704 608 688
WIRE 608 704 480 704
WIRE 752 704 752 640
WIRE 752 704 608 704
WIRE 1152 704 1152 592
WIRE 1152 704 752 704
WIRE 1632 704 1632 464
WIRE 1632 704 1152 704
WIRE 1856 704 1856 272
WIRE 1856 704 1632 704
WIRE 3088 752 3088 688
WIRE 3088 880 3088 832
WIRE 2384 992 2384 944
WIRE 2608 992 2384 992
WIRE 2800 992 2688 992
WIRE 2928 992 2800 992
WIRE 3040 992 2928 992
WIRE 2800 1008 2800 992
WIRE 2928 1008 2928 992
WIRE 3040 1008 3040 992
WIRE 2800 1120 2800 1072
WIRE 2928 1120 2928 1088
WIRE 2928 1120 2800 1120
WIRE 3040 1120 3040 1088
WIRE 3040 1120 2928 1120
WIRE 2800 1152 2800 1120
WIRE -1456 1184 -1456 1120
WIRE -1920 1248 -1920 1120
WIRE -1168 1248 -1168 1120
WIRE -1920 1392 -1920 1328
WIRE -1456 1456 -1456 1264
WIRE -1168 1456 -1168 1328
WIRE -1168 1456 -1456 1456
WIRE -1456 1488 -1456 1456
FLAG 528 144 0
FLAG -768 -176 IN
FLAG -1168 1120 IN
FLAG -640 704 B-
FLAG -640 -880 B+
FLAG 2448 -176 OUT
FLAG 320 -176 NEG_IN
FLAG 496 -176 FB
FLAG 2080 96 0
FLAG 3088 624 0
FLAG 3088 880 0
FLAG -1456 1488 0
FLAG 944 560 0
FLAG 944 -336 0
FLAG -1920 1392 0
FLAG -1456 1120 SINE
FLAG -1920 1120 SQR
FLAG 608 304 0
FLAG -592 112 0
FLAG 2800 1152 0
FLAG -96 -288 0
FLAG 544 -288 0
FLAG 2240 96 0
FLAG -608 -672 0
FLAG -608 528 0
SYMBOL res 672 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 33k
SYMBOL res 512 -128 R0
SYMATTR InstName R12
SYMATTR Value 1k
SYMBOL cap 512 48 R0
SYMATTR InstName C4
SYMATTR Value 1; 220µ
SYMBOL res -176 -112 R0
SYMATTR InstName R4
SYMATTR Value 22k
SYMBOL cap -608 -80 R0
SYMATTR InstName C1
SYMATTR Value 220p
SYMBOL res -608 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL cap 656 224 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 47p
SYMBOL npn 688 -48 R0
SYMATTR InstName Q11
SYMATTR Value BD139C
SYMBOL res 624 -128 R0
SYMATTR InstName R17
SYMATTR Value 10k
SYMBOL res 624 32 R0
SYMATTR InstName R18
SYMATTR Value 840
SYMBOL cap 2064 -128 R0
SYMATTR InstName C15
SYMATTR Value 100n
SYMBOL res 2064 -32 R0
SYMATTR InstName E24
SYMATTR Value 10
SYMBOL cap 848 -32 R0
SYMATTR InstName C7
SYMATTR Value 10µ
SYMBOL voltage -1456 1168 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value SINE(0 {a} {f})
SYMBOL res 3072 480 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R218
SYMATTR Value 2k
SYMBOL res 3200 480 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R223
SYMATTR Value 2k
SYMBOL cap 3072 528 R0
SYMATTR InstName C207
SYMATTR Value 159.2n
SYMBOL cap 2976 704 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C208
SYMATTR Value 79.62n
SYMBOL cap 3152 704 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C209
SYMATTR Value 79.62n
SYMBOL res 3072 736 R0
SYMATTR InstName R228
SYMATTR Value 1k
SYMBOL nmos 1584 -720 R0
SYMATTR InstName Q15
SYMATTR Value IRFP240
SYMBOL pmos 1584 464 M180
SYMATTR InstName Q16
SYMATTR Value IRFP9240
SYMBOL res 1584 -656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R22
SYMATTR Value 47
SYMBOL res 1568 368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value 47
SYMBOL diode 1440 -336 R0
SYMATTR InstName D5
SYMATTR Value 1N4148
SYMBOL zener 1472 -400 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMATTR Value UMZ6_8EN
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL zener 1440 0 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMATTR Value UMZ6_8EN
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL diode 1472 80 M0
SYMATTR InstName D7
SYMATTR Value 1N4148
SYMBOL cap -176 -192 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 1; 4.7µ
SYMBOL npn 1088 -768 R0
SYMATTR InstName Q13
SYMATTR Value TTC004B
SYMBOL pnp 1088 592 M180
SYMATTR InstName Q14
SYMATTR Value TTA004B
SYMBOL res 1136 -80 R0
SYMATTR InstName R21
SYMATTR Value 680
SYMBOL cap 1264 -64 R0
SYMATTR InstName C10
SYMATTR Value 220n
SYMBOL cap 928 432 R0
SYMATTR InstName C9
SYMATTR Value 47p
SYMBOL cap 928 -432 R0
SYMATTR InstName C8
SYMATTR Value 47p
SYMBOL bv -1920 1232 R0
SYMATTR InstName B1
SYMATTR Value v=if(time>1e-6,{a}*sgn(v(sine)),0)
SYMBOL bv -1168 1232 R0
SYMATTR InstName B2
SYMATTR Value V=if({square}>0,v(sqr),v(sine))
SYMBOL npn 688 416 R0
SYMATTR InstName Q12
SYMATTR Value BD139C
SYMBOL npn 544 336 R0
SYMATTR InstName Q8
SYMATTR Value 2N5550
SYMBOL res 736 544 R0
SYMATTR InstName R20
SYMATTR Value 33
SYMBOL diode 480 112 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL pnp 688 -592 M180
SYMATTR InstName Q10
SYMATTR Value BD140C
SYMBOL pnp 608 -672 R180
SYMATTR InstName Q9
SYMATTR Value 2N5401
SYMBOL res 528 -608 R0
SYMATTR InstName R15
SYMATTR Value 4.7k
SYMBOL npn 160 352 R0
SYMATTR InstName Q5
SYMATTR Value 2N5550
SYMBOL npn 48 352 M0
SYMATTR InstName Q3
SYMATTR Value 2N5550
SYMBOL res -32 528 R0
SYMATTR InstName R7
SYMATTR Value 100
SYMBOL res 208 528 R0
SYMATTR InstName R11
SYMATTR Value 100
SYMBOL pnp 48 -592 M180
SYMATTR InstName Q4
SYMATTR Value 2N5401
SYMBOL res 96 -848 R0
SYMATTR InstName R9
SYMATTR Value 470
SYMBOL pnp -32 -672 R180
SYMATTR InstName Q1
SYMATTR Value 2N5401
SYMBOL res -112 -608 R0
SYMATTR InstName R5
SYMATTR Value 4.7k
SYMBOL res 224 -448 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 100
SYMBOL res 96 -448 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 100
SYMBOL pnp 288 -128 R180
SYMATTR InstName Q6
SYMATTR Value 2N5401
SYMBOL pnp -80 -128 M180
SYMATTR InstName Q2
SYMATTR Value 2N5401
SYMBOL res -192 -288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R405
SYMATTR Value {dc_couple_res}
SYMBOL res 368 128 R180
WINDOW 0 36 76 Left 2
WINDOW 3 -80 -14 Left 2
SYMATTR InstName R406
SYMATTR Value {dc_couple_res}
SYMBOL res 2368 848 R0
SYMATTR InstName R115
SYMATTR Value 6.8
SYMBOL ind 2592 1008 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L3
SYMATTR Value 1m
SYMBOL cap 2784 1008 R0
SYMATTR InstName C115
SYMATTR Value 500µ
SYMBOL ind 2912 992 R0
SYMATTR InstName L104
SYMATTR Value 20m
SYMBOL res 3024 992 R0
SYMATTR InstName R122
SYMATTR Value 22
SYMBOL voltage 496 -176 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
WINDOW 123 25 49 VBottom 2
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value ""
SYMATTR Value2 AC 1
SYMBOL npn 544 496 M0
SYMATTR InstName Q7
SYMATTR Value 2N5550
SYMBOL res -112 -464 R0
SYMATTR InstName R6
SYMATTR Value 4.7k
SYMBOL res 528 -432 R0
SYMATTR InstName R16
SYMATTR Value 4.7k
SYMBOL res 2224 -112 R0
SYMATTR InstName R30
SYMATTR Value 4
SYMBOL cap -304 -704 R0
SYMATTR InstName C2
SYMATTR Value 4.7µ
SYMBOL cap 352 -704 R0
SYMATTR InstName C5
SYMATTR Value 4.7µ
SYMBOL diode 160 -112 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL diode 96 16 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL res -464 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R33
SYMATTR Value {r_vol_hi}
SYMBOL res -480 -112 R0
SYMATTR InstName R404
SYMATTR Value {r_vol_lo}
SYMBOL res -464 -160 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R3
SYMATTR Value 470
SYMBOL res 736 -848 R0
SYMATTR InstName R2
SYMATTR Value 56
SYMBOL res 592 592 R0
SYMATTR InstName R13
SYMATTR Value 1k
SYMBOL res 1616 -496 R0
SYMATTR InstName R19
SYMATTR Value 0.22
SYMBOL res 1616 -16 R0
SYMATTR InstName R24
SYMATTR Value 0.22
SYMBOL nmos 1808 -624 R0
SYMATTR InstName Q17
SYMATTR Value IRFP240
SYMBOL res 1776 -560 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R27
SYMATTR Value 0.22
SYMBOL res 1840 -496 R0
SYMATTR InstName R25
SYMATTR Value 0.22
SYMBOL pmos 1808 272 M180
SYMATTR InstName Q18
SYMATTR Value IRFP9240
SYMBOL res 1760 176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R26
SYMATTR Value 47
SYMBOL res 1840 -16 R0
SYMATTR InstName R28
SYMATTR Value 0.22
SYMBOL res 1424 -656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R29
SYMATTR Value 47
SYMBOL res 1408 368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R31
SYMATTR Value 47
SYMBOL voltage -608 -816 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 56
SYMBOL voltage -608 560 R0
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 56
TEXT -352 800 Left 2 !.param f=1k a=1.3 square=0 sim_time=100m delay=0 dc_coupled=0 r_pot=50k vol=1\n.param dc_couple_res=if({dc_coupled}>0,1p,10G)\n.param r_vol_hi=1m+(1-vol)*r_pot r_vol_lo=1m+vol*r_pot\n.tran 0 {sim_time+delay} {delay} 100n\n.four {f} 50 -1 v(out)\n.option plotwinsize=0 NoOpiter numdgt=15\n; .step param vol list  0.25 0.5 0.75 1
TEXT -344 752 Left 2 ;.ac dec 1000 1 10meg
TEXT -344 1024 Left 2 ;.noise out in dec 1000 1 1meg
TEXT 2952 392 Left 2 ;Notch filter for time domain distortion test
TEXT 760 808 Left 2 ;f - Input frequency\na - Input amplitude\nvol - Volume\nsquare - Set to non-zero for square wave input\nsim_time - Simulation time (not counting settling delay)\ndelay - Settling delay. Set to several seconds for accurate THD\ndc_coupled = Shorts high value capacitors to allow for quick THD checks
TEXT -336 1096 Left 2 !.lib "Cabirio-BJTmodels.txt"
